# Copied from https://github.com/logandonley/dotfiles/
# based on https://www.youtube.com/watch?v=-RkANM9FfTM
---
- name: Machine setup
  hosts: localhost
  become: true
  connection: local
  gather_facts: true
  tasks:
    - name: Get my user
      ansible.builtin.set_fact:
        remote_regular_user: "{{ ansible_env.SUDO_USER or ansible_user_id }}"

    - name: Install packages graphics
      ansible.builtin.dnf:
        name:
          - firefox
          - gnome-tweaks
          - go-task
          - ripgrep
          - poetry
          - wl-clipboard
          - doctl
          - helix
          - wxGTK-devel
          - wxBase
        state: present

    - name: Import Microsoft GPG Key
      ansible.builtin.rpm_key:
        key: https://packages.microsoft.com/keys/microsoft.asc
        state: present

    - name: Add Visual Studio Code Repo
      ansible.builtin.yum_repository:
        name: vscode
        description: Visual Studio Code
        baseurl: https://packages.microsoft.com/yumrepos/vscode
        gpgkey: https://packages.microsoft.com/keys/microsoft.asc
        gpgcheck: true
        enabled: true

    - name: Install VS Code
      ansible.builtin.dnf:
        name: code
        state: present

    - name: Install Flatpak packages
      community.general.flatpak:
        name:
          - org.videolan.VLC
        state: present

    - name: Ensure fonts directory
      ansible.builtin.file:
        path: "~{{ remote_regular_user }}/.fonts"
        state: directory
        mode: "0755"
        owner: "{{ remote_regular_user }}"
