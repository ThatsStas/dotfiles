- name: Detect display server
  ansible.builtin.shell: |
    if [ -n "$(pgrep -a Xorg)" ]; then
      echo X11
    elif [ -n "$(pgrep -a wayland)" ] || [ -n "$(loginctl show-session $(loginctl | awk 'NR==2{print $1}') -p Type | cut -d= -f2)" ] && [ "$(loginctl show-session $(loginctl | awk 'NR==2{print $1}') -p Type | cut -d= -f2)" = "wayland" ]; then
      echo Wayland
    else
      echo none
    fi
  args:
    executable: /bin/bash
  register: display_type
  changed_when: false

- name: Always run common configuration
  import_playbook: common.yml

- name: Include X11 or Wayland extended tasks
  import_playbook: graphical.yml
  when: display_type.stdout in ["X11", "Wayland"]